# VPC Overview
- Limit of 5 VPCs per region (quota limit - can increase to 100 - hard limit)
- Think of VPC as a logical datacenter in AWS
- Consists of IGWs (Or Virtual Private Gateways), Route Tables, Network Access Control Lists, Subnets, And Security Groups
- 1 Subnet = 1 Availability Zone
- Security Groups are Stateful; Network Access Control Lists are Stateless;
- NO TRANSITIVE PEERING

# Building Custom VPC
- When you create a VPC a default Route Table, Network Access Control List (NACL) and a default Security Group are created too
- It won't create any subnets, nor will it create a default internet gateway
- US-East-1A in your AWS account can be completely different availability zone to US-East-1A in another AWS account. The AZ's are randomized.
- Amazon always reserves 5 IP addresses within your subnets
  - 10.0.0.0 - Network address
  - 10.0.0.1 - VPC router
  - 10.0.0.2 - DNS server
  - 10.0.0.3 - Reserved by AWS for future use
  - 10.0.0.255 - Network broadcast address
- You can only have 1 Internet Gateway per VPC
- Security Groups can't span VPCs

# NAT Instances vs NAT Gateways
## Net Instances 
- Nat instance = EC2 instance used to allow access to internet (outside the VPC/AWS)
- When creating a NAT instance, Disable Source/Destination Check on the Instance
- NAT instances must be in a public subnet
- There must be a route out of the private subnet to the NAT instance, in order for this to work
- The amount of traffic that NAT instances can support depends on the instance size. If you are bottlenecking, increase the instance size
- You can create high availability using Autoscaling Groups, multiple subnets in different AZs, and a script to automate failover
- Behind a Security Group

## Net Gateways
- Redundant inside the Availability Zone
- Preferred by the enterprise
- Starts at 5GBps and scales currently to 45Gbps
- No need to patch
- Not associated with security groups
- Automatically assigned a public ip address
- Remember to update your route tables
- No need to disable Source/Destination Checks
- If you have resources in multiple Availability Zones and the share one NAT gateway, in the event that the NAT gateway's Availability Zone is down, resources in the other Availability Zones lose internet access. To create an Availability Zone-independent architecture, create a NAT gateway in each Availability Zone and configure your routing to ensure that resources use the NAT gateway in the same Availability Zone.

## Access Control Lists (ACL)
- Your VPC automatically comes with a default network ACL, and by default it allows all outbound and inbound traffic
- You can create custom network ACLs. By default, each custom network ACL denies all inbound and outbound traffic until you add rules
- Each subnet in your VPC must be associated with a network ACL. If you don't explicity associate a subnet with a network ACL, the subnet is automatically associated with the default network ACL
- Block IP Addresses using ACLs not Security Groups
- You can associate a network ACL with multiple subnets; however, a subnet can be associated with only one ACL at a time. When you associate a network ACL with a subnet, the previous association is removed
- Network ACLs contain a numbered list of rules that is evaluated in order, starting with the lowest numbered rule
- Network ACLs have separate inbound and outbound rules, and each rule can eather allow or deny traffic
- Network ACLs are stateless; responses to allowed inbound traffic are subject to the rules for outbound traffic (and vice versa)

## Elastic Load Balances
- You need a minimum of two public subnets to deploy an internet facing loadbalancer

## Flow Logs
- You cannot enable flow logs for VPCs that are peered with your VPC unless the peer VPC is in your account (it cannot be cross account)
- You can tag flow logs
- After you've created a flow log, you cannot change its configuration; for example, you can't associate different IAM role with the flow log
- Not all IP traffic is monitored:
  - Traffic generated by instances when they contact the Amazon DNS server. If you use your own DNS server, then all traffic to that DNS server is logged
  - Traffic generated by a Windows instance for Amazon Windows license activation
  - Traffic to and from 169.254.169.254 for instance metadata
  - Dynamic Host Configuration Protocol (DHCP) traffic
  - Traffic to the reserved IP address for the default VPC router

## Bastions
- A NAT Gateway or NAT Instance is used to provide internet traffic to EC2 instances in a private subnets
- A Bastion is used to securely administer EC2 instances (using SSH or RDP). Bastions are called Jump Boxes in Australia
- You cannot use a NAT Gateway as a Bastion host

## Direct Connect
- Direct Connect directly connects your data centers to AWS
- Useful for high throughput workloads (ie lots of network traffic)
- Or if you neet a stable and reliable secure connection

## Setting up Direct Connect - Steps
- Create a virtual interface in the Direct Connect console. This is a PUBLIC Virtual interface
- Go to the VPC console and then to VPN connections. Create a Customer Gateway
- Create a Virtual Private Gateway
- Attach the Virtual Private Gateway to the desired VPC
- Select VPN Connections and create new VPN COnnection
- Select the Virtual Private Gateway and the Customer Gateway
- Once the VPN is available, set up the VPN on the customer gatweway or firewall

## AWS Global Accelerator
- AWS Global Accelerator is a service in which you create accelerators to improve availability and performance of your applications for local and global users
- You are assigned two static IP address (or alternatively you can bring your own)
- You can control traffic using traffic dials. This is done within the endpoint group
- You can control weighting to individuals endpoints using weights

## VPC Endpoints
- VPN endpoint enables you to privately connect your VPC to supported AWS services and VPC endpoint services powered by PrivateLink without requiring an internet gateway, NAT device, VPN connection, or AWS Direct Connect connection. Instances in your VPC do not require public IP address to communicate with resources in the service. Traffic between your VPC and the other service does not leave the Amazon network
- Endpoint are virtual devices. They are horizontally scaled, reduntant, and highly available VPC components that allow communication between instances in your VPC and services without imposing availability risks or bandwidth constraints on your network traffic
- There are two types of VPC endpoints:
  - Interface endpoints
  - Gateway endpoints
